<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Teste API de Livraria</title>
    <link rel="stylesheet" href="style.css"> <!-- Link para o arquivo CSS -->
</head>
<body>
    <h1>Livraria API</h1>
    <h2>Livros Disponíveis</h2>
    <ul class="book-list" id="book-list"></ul>

    <h3>Cadastrar Livro</h3>
    <form id="book-form">
        <input type="text" id="title" placeholder="Título" required>
        <input type="text" id="author" placeholder="Autor" required>
        <input type="text" id="genre" placeholder="Gênero" required>
        <input type="text" id="year" placeholder="Ano de Publicação" required>
        <button type="submit">Cadastrar</button>
    </form>

    <script>
        const apiUrlGetBooks = 'http://localhost:8080/library/api/livro/listar'; // Rota correta para listar os livros
        const apiUrlCreateBook = 'http://localhost:8080/library/api/livro/criar'; // Rota correta para criar um novo livro
        const token = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJleHAiOjE3MzM4ODU5ODksInVzZXJfbmFtZSI6ImxpYnJhcnkiLCJhdXRob3JpdGllcyI6WyJST0xFX1VTRVIiXSwianRpIjoiNGQ3YTU2ZDMtYzE0Mi00N2FlLWE3NzctMThhMmJiNjhmNDg3IiwiY2xpZW50X2lkIjoibGlicmFyeWFwaSIsInNjb3BlIjpbInJlYWQiLCJ3cml0ZSJdfQ.tiqISFiZVuV5EBenMSolONxUD8hqk3Xey-hlUNMKlqg';  // Substitua pelo seu token Bearer

        // Função para carregar livros
        function loadBooks() {
            fetch(apiUrlGetBooks, {
                method: 'GET',
                headers: {
                    'Authorization': 'Bearer ' + token,
                    'Content-Type': 'application/json'
                }
            })
            .then(response => response.json())
            .then(data => {
                console.log('Dados recebidos da API:', data); // Adiciona um log dos dados recebidos
                const bookList = document.getElementById('book-list');
                bookList.innerHTML = ''; // Limpa a lista antes de adicionar os livros

                if (Array.isArray(data)) {
                    data.forEach(book => {
                        const listItem = document.createElement('li');
                        listItem.classList.add('book-item');
                        listItem.textContent = `${book.titulo} - ${book.autor} (${book.genero}, ${book.anoPublicacao})`;
                        bookList.appendChild(listItem);
                    });
                } else {
                    console.error('Os dados recebidos não são um array:', data);
                }
            })
            .catch(error => console.error('Erro ao carregar livros:', error));
        }

        // Função para cadastrar um livro
        document.getElementById('book-form').addEventListener('submit', function(event) {
            event.preventDefault();

            const title = document.getElementById('title').value;
            const author = document.getElementById('author').value;
            const genre = document.getElementById('genre').value;
            const year = document.getElementById('year').value;

            const newBook = { 
                titulo: title, 
                autor: author, 
                genero: genre, 
                anoPublicacao: year 
            };

            fetch(apiUrlCreateBook, {
                method: 'POST',
                headers: {
                    'Authorization': 'Bearer ' + token,
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify(newBook),
            })
            .then(response => response.json())
            .then(data => {
                console.log('Livro cadastrado:', data); // Verifique a resposta da API

                // Se a resposta for um objeto, e não um array, você pode tratar dessa forma
                if (data && data.titulo && data.autor) {
                    console.log('Livro cadastrado com sucesso:', data);
                    loadBooks(); // Recarrega a lista de livros após o cadastro
                } else {
                    console.error('Erro ao cadastrar livro:', data);
                }
            })
            .catch(error => console.error('Erro ao cadastrar livro:', error));
        });

        // Carregar livros ao iniciar
        window.onload = loadBooks;
    </script>
</body>
</html>
